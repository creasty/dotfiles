#!/usr/bin/env bash

DEFAULT_REMOTE=origin
DEFAULT_BRANCH=$(git symbolic-ref --short HEAD)

SUB_COMMAND="$1"

shift

ARGS=()
OPTS=()

for a in "$@"; do
  case "$a" in
    --ff|-ff|f)
      OPTS=("${OPTS[@]}" '--ff --ff-only')
      ;;
    -*)
      OPTS=("${OPTS[@]}" "$a")
      ;;
    m)
      ARGS=("${ARGS[@]}" 'master')
      ;;
    d)
      ARGS=("${ARGS[@]}" 'develop')
      ;;
    *)
      ARGS=("${ARGS[@]}" "$a")
      ;;
  esac
done

# one of:
#
# `remote:`
# `remote:branch`
# `:branch`
# `branch`
TARGET="${ARGS[0]}"

if [[ "$TARGET" = *:* ]]; then
  REMOTE="${TARGET%%:*}"
  BRANCH="${TARGET#*:}"
else
  REMOTE=""
  BRANCH="$TARGET"
fi

[ -z "$REMOTE" ] && REMOTE="$DEFAULT_REMOTE"
[ -z "$BRANCH" ] && BRANCH="$DEFAULT_BRANCH"

COMMAND=(git)
COMMAND=(${COMMAND[@]} $SUB_COMMAND)
COMMAND=(${COMMAND[@]} ${OPTS[@]})
COMMAND=(${COMMAND[@]} $REMOTE)
COMMAND=(${COMMAND[@]} $BRANCH)

echo "${COMMAND[@]}"
${COMMAND[@]}
