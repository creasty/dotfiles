#!/usr/bin/env bash

DEFAULT_REMOTE=origin
DEFAULT_BRANCH=$(git symbolic-ref --short HEAD)

SUB_COMMAND="$1"

shift

ARGS=()
OPTS=()

for a in "$@"; do
  case "$a" in
    --ff)
      OPTS=("${OPTS[@]}" '--ff --ff-only')
      ;;
    -*)
      OPTS=("${OPTS[@]}" "$a")
      ;;
    *)
      ARGS=("${ARGS[@]}" "$a")
      ;;
  esac
done

if [ ${#ARGS[@]} -ge 2 ]; then
  REMOTE="${ARGS[0]}"
  BRANCH="${ARGS[1]}"
else
  REMOTE="="
  BRANCH="${ARGS[0]}"
fi

if [[ "$REMOTE" =~ ^=?$ ]]; then
  REMOTE="$DEFAULT_REMOTE"
fi
if [[ "$BRANCH" =~ ^=?$ ]]; then
  BRANCH="$DEFAULT_BRANCH"
fi

COMMAND=(git)
COMMAND=(${COMMAND[@]} $SUB_COMMAND)
COMMAND=(${COMMAND[@]} ${OPTS[@]})
COMMAND=(${COMMAND[@]} $REMOTE)
COMMAND=(${COMMAND[@]} $BRANCH)

echo "${COMMAND[@]}"
${COMMAND[@]}
