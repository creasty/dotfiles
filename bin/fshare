#!/usr/bin/env bash

# TODO:
# Encrypt & upload:
# cat /tmp/hello.txt|gpg -ac -o-|curl -X PUT --upload-file "-" https://transfer.sh/test.txt
# Download & decrypt:
# curl https://transfer.sh/1lDau/test.txt|gpg -o- > /tmp/hello.txt

HOST="https://transfer.sh"

FILE="$1"

[ -f "$FILE" ] || exit 1

UPLOADING_FILE="$(md5 -r "$FILE" | cut -c -32).$(date +"%Y%m%d%H%M%S").${FILE##*.}"
UPLOADED_FILE="$(curl --progress-bar --upload-file "$FILE" "$HOST/$UPLOADING_FILE")"

[ $? -ne 0 ] && exit 1

echo "$UPLOADED_FILE"
pbcopy <<< "$UPLOADED_FILE"
