#!/usr/bin/env bash

SERVERS="$(gvim --serverlist | sed -e 's/^VIM$/0/g' -e 's/^VIM//g')"

if [ -z "$SERVERS" ]; then
  gvim -g $@
else
  if [ `echo "$SERVERS" | wc -l` -lt 2 ]; then
    SERVER="$(echo "$SERVERS" | head -n 1 | tr -d "\n")"
  else
    SERVER="$(peco <<< "$SERVERS" | tr -d "\n")"
  fi

  [ -z "$SERVER" ] && exit 1

  SELECTED_SERVER="$(echo "$SERVER" | sed -e 's/0//' -e 's/^/VIM/g')"
  gvim -g --servername "$SELECTED_SERVER" --remote-tab-silent $@
fi
