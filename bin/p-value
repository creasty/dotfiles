#!/usr/bin/env bash
#> p-value N1/D1 N2/D2
#>
#>     N: Numerator
#>     D: Denominator

set -eu
set -o pipefail

WORKSPACE_PATH="$HOME/docker/r-base"
TMP_SCRIPT_FILE='tmp.r'

INPUT_PATTERN='([0-9]+)\/([0-9]+)[ ]+([0-9]+)\/([0-9]+)'
R_TEMPLATE='prop.test(c(\1, \3), c(\2, \4))'

do_help() {
  cat "$0" | grep '^#>' | sed -E 's/#>[ ]?//g'
  exit 1
}

echo "$@" \
  | {
    grep -o -m 1 -E "$INPUT_PATTERN" || do_help
  } \
  | sed -E "s/$INPUT_PATTERN/$R_TEMPLATE/" \
  | tee "$WORKSPACE_PATH/$TMP_SCRIPT_FILE"

r-base Rscript "$TMP_SCRIPT_FILE"
