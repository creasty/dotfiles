#!/usr/bin/env bash

source "$(dirname $0)/../lib/helpers.sh"

ARGS="$@"

ps aux \
  | grep -v $0 \
  | grep -v grep \
  | grep -v peco \
  | sed '1d' \
  | {
    if [ "$ARGS" = '' ]; then
      cat | peco
    else
      cat | peco --query "$ARGS"
    fi
  } \
  | {
    sel="$(cat)"

    if ! [ -z "$sel" ]; then
      echo "$sel"
      echo "$sel" \
        | awk '{ print $2 }' \
        | xargs kill -9
    fi
  }
