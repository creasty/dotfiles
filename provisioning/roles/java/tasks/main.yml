- set_fact:
    java: {}

- name: install openjdk
  homebrew:
    name: openjdk
    state: latest

- name: tap adoptopenjdk/openjdk
  homebrew_tap:
    tap:   adoptopenjdk/openjdk
    state: present

- name: install old versions
  homebrew_cask:
    name: adoptopenjdk11
    state: latest
    sudo_password: '{{ ansible_become_pass }}'

- name: check jenv
  command: |
    bash -lc 'which jenv'
  register: which_jenv
  ignore_errors: yes

- name: install jenv
  command: |
    bash -lc 'anyenv install -s jenv'
  when: which_jenv.rc > 0

- name: enable export plugin
  command: |
    bash -lc 'jenv enable-plugin export'

- name: apply patch to export plugin
  patch:
    src: export_jenv_hook.zsh.patch
    dest: '{{ anyenv.envs_dir }}/jenv/plugins/export/etc/jenv.d/init/export_jenv_hook.zsh'

- name: register java home
  command: |
    bash -lc 'jenv add "$(/usr/libexec/java_home)"'

- name: install tools
  homebrew:
    name:  '{{ item }}'
    state: latest
  with_items:
    - gradle                     # Open-source build automation tool based on the Groovy and Kotlin DSL
    - pre-commit                 # Framework for managing multi-language pre-commit hooks
    - coursier/formulas/coursier # Launcher for Coursier (required by pre-commit)

# - name: install IDEs
#   homebrew_cask:
#     name:  '{{ item }}'
#     state: present
#   with_items:
#     - intellij-idea-ce
#     #- android-sdk
#     #- android-studio
