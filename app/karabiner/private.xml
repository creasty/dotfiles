<?xml version="1.0"?>
<root>
  <!--
  - Karabiner.app/Contents/Resources/include/checkbox
  - Karabiner.app/Contents/Resources/appdef.xml
  - Karabiner.app/Contents/Resources/modifierdef.xml

  https://pqrs.org/osx/karabiner/xml.html.en
  -->

  <appdef>
    <appname>MACVIM</appname>
    <equal>org.vim.MacVim</equal>
  </appdef>

  <modifierdef>PRIVATE_SUPER_MODE</modifierdef>
  <modifierdef>PRIVATE_SKEY</modifierdef>

  <replacementdef>
    <replacementname>EMACS_MODE_IGNORE_APPS</replacementname>
    <replacementvalue>
      ECLIPSE,
      EMACS,
      REMOTEDESKTOPCONNECTION,
      TERMINAL,
      VI,
      MACVIM,
      VIRTUALMACHINE,
      X11,
    </replacementvalue>
  </replacementdef>

  <list>
    <item>
      <name>Application hotkey</name>
      <identifier>private.app_hotkey</identifier>

      <appendix>Cmd-' to toggle open finder</appendix>

      <block>
        <not>FINDER</not>
        <autogen>
          __KeyToKey__
          KeyCode::QUOTE, VK_COMMAND | ModifierFlag::NONE,
          KeyCode::VK_OPEN_URL_APP_Finder
        </autogen>
      </block>
      <block>
        <only>FINDER</only>
        <autogen>
          __KeyToKey__
          KeyCode::QUOTE, VK_COMMAND | ModifierFlag::NONE,
          KeyCode::H, VK_COMMAND
        </autogen>
      </block>
    </item>

    <item>
      <name>MacVim</name>
      <identifier>private.macvim</identifier>
      <only>MACVIM</only>

      <appendix>Leave InsMode with EISUU</appendix>

      <autogen>
        __KeyToKey__
        KeyCode::ESCAPE,
        KeyCode::ESCAPE, KeyCode::JIS_EISUU
      </autogen>
      <autogen>
        __KeyToKey__
        KeyCode::C, VK_CONTROL,
        KeyCode::C, VK_CONTROL, KeyCode::JIS_EISUU
      </autogen>
      <autogen>
        __KeyToKey__
        KeyCode::BRACKET_LEFT, VK_CONTROL,
        KeyCode::BRACKET_LEFT, VK_CONTROL, KeyCode::JIS_EISUU
      </autogen>
    </item>

    <item>
      <name>Ctrl-; to toggle input source</name>
      <identifier>private.ctrl_semicolon_toggle_input_source</identifier>

      <block>
        <inputsource_only>JAPANESE</inputsource_only>
        <autogen>
          __KeyToKey__
          KeyCode::SEMICOLON, VK_CONTROL | ModifierFlag::NONE,
          KeyCode::JIS_EISUU
        </autogen>
        <autogen>
          __KeyToKey__
          KeyCode::SEMICOLON, ModifierFlag::NONE,
          KeyCode::JIS_EISUU
        </autogen>
      </block>
      <block>
        <inputsource_not>JAPANESE</inputsource_not>
        <autogen>
          __KeyToKey__
          KeyCode::SEMICOLON, VK_CONTROL | ModifierFlag::NONE,
          KeyCode::JIS_KANA
        </autogen>
      </block>
    </item>

    <item>
      <name>Super mode</name>
      <identifier>private.super_mode</icentifier>

      <appendix>S+H: Move to left space</appendix>
      <appendix>S+L: Move to right space</appendix>
      <appendix>S+J: Switch to next application</appendix>
      <appendix>S+K: Switch to previous application</appendix>
      <appendix>S+N: Switch to next window</appendix>
      <appendix>S+B: Switch to previous window</appendix>

      <block>
        <modifier_not>
          ModifierFlag::COMMAND_L,
          ModifierFlag::COMMAND_R,
          ModifierFlag::CONTROL_L,
          ModifierFlag::CONTROL_R,
          ModifierFlag::FN,
          ModifierFlag::OPTION_L,
          ModifierFlag::OPTION_R,
          ModifierFlag::SHIFT_L,
          ModifierFlag::SHIFT_R,
        </modifier_not>

        <autogen>
          __KeyOverlaidModifier__
          KeyCode::S,

          @begin
          KeyCode::VK_MODIFIER_PRIVATE_SUPER_MODE,
          @end

          @begin
          KeyCode::S,
          @end
        </autogen>
      </block>

      <block>
        <modifier_only>ModifierFlag::PRIVATE_SUPER_MODE</modifier_only>

        <autogen>
          __BlockUntilKeyUp__
          KeyCode::S
        </autogen>

        <autogen>
          __KeyToKey__
          KeyCode::H,
          KeyCode::CURSOR_LEFT, ModifierFlag::CONTROL_L,
          ModifierFlag::PRIVATE_SUPER_MODE,
        </autogen>
        <autogen>
          __KeyToKey__
          KeyCode::L,
          KeyCode::CURSOR_RIGHT, ModifierFlag::CONTROL_L,
          ModifierFlag::PRIVATE_SUPER_MODE,
        </autogen>
        <autogen>
          __KeyToKey__
          KeyCode::J,
          KeyCode::TAB, ModifierFlag::COMMAND_L,
          ModifierFlag::PRIVATE_SUPER_MODE,
        </autogen>
        <autogen>
          __KeyToKey__
          KeyCode::K,
          KeyCode::TAB, ModifierFlag::COMMAND_L | ModifierFlag::SHIFT_L,
          ModifierFlag::PRIVATE_SUPER_MODE,
        </autogen>

        <autogen>
          __KeyToKey__
          KeyCode::N,
          KeyCode::BACKQUOTE, ModifierFlag::COMMAND_L,
          ModifierFlag::PRIVATE_SUPER_MODE,
        </autogen>
        <autogen>
          __KeyToKey__
          KeyCode::B,
          KeyCode::BACKQUOTE, ModifierFlag::COMMAND_L | ModifierFlag::SHIFT_L,
          ModifierFlag::PRIVATE_SUPER_MODE,
        </autogen>

        <autogen>
          __DropAllKeys__
          ModifierFlag::PRIVATE_SUPER_MODE,
          Option::DROPALLKEYS_DROP_KEY,
        </autogen>
      </block>
    </item>

    <item>
      <name>Tab controls</name>
      <identifier>private.tab_controls</identifier>
      <not>{{EMACS_MODE_IGNORE_APPS}}</not>

      <appendix>Control-S Control-N: Move to next tab</appendix>
      <appendix>Control-S Control-B: Move to previous tab</appendix>
      <appendix>Control-S Control-T: Open new tab</appendix>
      <appendix>Control-S Control-D: Close tab</appendix>

      <autogen>
        __KeyOverlaidModifier__
        KeyCode::S, ModifierFlag::CONTROL_L,

        @begin
        KeyCode::S, ModifierFlag::CONTROL_L,
        KeyCode::VK_MODIFIER_PRIVATE_SKEY,
        @end

        @begin
        KeyCode::VK_STICKY_ACTIVE_MODIFIERS_FORCE_ON,
        KeyCode::VK_STICKY_PRIVATE_SKEY,
        @end
      </autogen>

      <block>
        <modifier_only>ModifierFlag::PRIVATE_SKEY</modifier_only>

        <autogen>
          __KeyToKey__
          KeyCode::N, ModifierFlag::CONTROL_L,
          KeyCode::BRACKET_RIGHT, ModifierFlag::COMMAND_L | ModifierFlag::SHIFT_L,
        </autogen>
        <autogen>
          __KeyToKey__
          KeyCode::N,
          KeyCode::BRACKET_RIGHT, ModifierFlag::COMMAND_L | ModifierFlag::SHIFT_L,
        </autogen>
        <autogen>
          __KeyToKey__
          KeyCode::B, ModifierFlag::CONTROL_L,
          KeyCode::BRACKET_LEFT, ModifierFlag::COMMAND_L | ModifierFlag::SHIFT_L,
        </autogen>
        <autogen>
          __KeyToKey__
          KeyCode::B,
          KeyCode::BRACKET_LEFT, ModifierFlag::COMMAND_L | ModifierFlag::SHIFT_L,
        </autogen>
        <autogen>
          __KeyToKey__
          KeyCode::T, ModifierFlag::CONTROL_L,
          KeyCode::T, ModifierFlag::COMMAND_L,
        </autogen>
        <autogen>
          __KeyToKey__
          KeyCode::T,
          KeyCode::T, ModifierFlag::COMMAND_L,
        </autogen>
        <autogen>
          __KeyToKey__
          KeyCode::D, ModifierFlag::CONTROL_L,
          KeyCode::W, ModifierFlag::COMMAND_L,
        </autogen>
        <autogen>
          __KeyToKey__
          KeyCode::D,
          KeyCode::W, ModifierFlag::COMMAND_L,
        </autogen>

        <autogen>
          __DropAllKeys__
          ModifierFlag::PRIVATE_SKEY,
          Option::DROPALLKEYS_DROP_KEY,
        </autogen>
      </block>
    </item>

    <item>
      <name>Chrome</name>
      <identifier>private.chrome</identifier>
      <only>GOOGLE_CHROME</only>

      <appendix>Control-I: History forward</appendix>
      <appendix>Control-O: History back</appendix>

      <autogen>
        __KeyToKey__
        KeyCode::I, ModifierFlag::CONTROL_L,
        KeyCode::BRACKET_LEFT, ModifierFlag::COMMAND_L,
      </autogen>
      <autogen>
        __KeyToKey__
        KeyCode::O, ModifierFlag::CONTROL_L,
        KeyCode::BRACKET_RIGHT, ModifierFlag::COMMAND_L,
      </autogen>
    </item>

    <item>
      <name>Contorl-v to Cmd-V</name>
      <identifier>private.cv</identifier>

      <autogen>
        __KeyToKey__
        KeyCode::V, ModifierFlag::CONTROL_L,
        KeyCode::V, ModifierFlag::COMMAND_L,
      </autogen>
    </item>

  </list>
</root>
